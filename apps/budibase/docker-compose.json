{
  "services": [
    {
      "name": "app-service",
      "image": "budibase/apps:3.20.6",
      "environment": {
        "SELF_HOSTED": "1",
        "PORT": "${APP_PORT}",
        "COUCH_DB_URL": "http://${COUCH_DB_USER}:${COUCH_DB_PASSWORD}@couchdb-service:${COUCH_DB_PORT}",
        "WORKER_URL": "http://worker-service:${WORKER_PORT}",
        "MINIO_URL": "http://minio-service:${MINIO_PORT}",
        "MINIO_ACCESS_KEY": "${MINIO_ACCESS_KEY}",
        "MINIO_SECRET_KEY": "${MINIO_SECRET_KEY}",
        "INTERNAL_API_KEY": "${INTERNAL_API_KEY}",
        "BUDIBASE_ENVIRONMENT": "${BUDIBASE_ENVIRONMENT}",
        "API_ENCRYPTION_KEY": "${API_ENCRYPTION_KEY}",
        "JWT_SECRET": "${JWT_SECRET}",
        "LOG_LEVEL": "info",
        "ENABLE_ANALYTICS": "true",
        "REDIS_URL": "redis-service:${REDIS_PORT}",
        "REDIS_PASSWORD": "${REDIS_PASSWORD}",
        "BB_ADMIN_USER_EMAIL": "${BB_ADMIN_USER_EMAIL}",
        "BB_ADMIN_USER_PASSWORD": "${BB_ADMIN_USER_PASSWORD}",
        "PLUGINS_DIR": "${PLUGINS_DIR}",
        "OFFLINE_MODE": "${OFFLINE_MODE}",
        "SQL_MAX_ROWS": "${SQL_MAX_ROWS}",
        "ROLLING_LOG_MAX_SIZE": "${ROLLING_LOG_MAX_SIZE}",
        "COUCH_DB_SQS_PORT": "${COUCH_DB_SQS_PORT}"
      },
      "dependsOn": {
        "worker-service": {
          "condition": "service_started"
        },
        "redis-service": {
          "condition": "service_started"
        },
        "couchdb-service": {
          "condition": "service_started"
        },
        "minio-service": {
          "condition": "service_started"
        }
      }
    },
    {
      "name": "worker-service",
      "image": "budibase/worker:3.21.1",
      "environment": {
        "SELF_HOSTED": "1",
        "PORT": "${WORKER_PORT}",
        "CLUSTER_PORT": "${MAIN_PORT}",
        "API_ENCRYPTION_KEY": "${API_ENCRYPTION_KEY}",
        "JWT_SECRET": "${JWT_SECRET}",
        "MINIO_ACCESS_KEY": "${MINIO_ACCESS_KEY}",
        "MINIO_SECRET_KEY": "${MINIO_SECRET_KEY}",
        "MINIO_URL": "http://minio-service:${MINIO_PORT}",
        "APPS_URL": "http://app-service:${APP_PORT}",
        "COUCH_DB_USERNAME": "${COUCH_DB_USER}",
        "COUCH_DB_PASSWORD": "${COUCH_DB_PASSWORD}",
        "COUCH_DB_URL": "http://${COUCH_DB_USER}:${COUCH_DB_PASSWORD}@couchdb-service:${COUCH_DB_PORT}",
        "INTERNAL_API_KEY": "${INTERNAL_API_KEY}",
        "REDIS_URL": "redis-service:${REDIS_PORT}",
        "REDIS_PASSWORD": "${REDIS_PASSWORD}",
        "OFFLINE_MODE": "${OFFLINE_MODE}",
        "ROLLING_LOG_MAX_SIZE": "${ROLLING_LOG_MAX_SIZE}",
        "COUCH_DB_SQS_PORT": "${COUCH_DB_SQS_PORT}"
      },
      "dependsOn": {
        "redis-service": {
          "condition": "service_started"
        },
        "minio-service": {
          "condition": "service_started"
        },
        "couchdb-service": {
          "condition": "service_started"
        }
      }
    },
    {
      "name": "minio-service",
      "image": "minio/minio:RELEASE.2025-09-07T16-13-09Z",
      "command": "server /data --address \":${MINIO_PORT}\" --console-address \":9001\"",
      "environment": {
        "MINIO_ACCESS_KEY": "${MINIO_ACCESS_KEY}",
        "MINIO_SECRET_KEY": "${MINIO_SECRET_KEY}",
        "MINIO_BROWSER": "off"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/budibase/minio",
          "containerPath": "/data",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ],
      "healthCheck": {
        "test": "timeout 5s bash -c ':> /dev/tcp/127.0.0.1/${MINIO_PORT}' || exit 1",
        "interval": "30s",
        "timeout": "20s",
        "retries": 3
      }
    },
    {
      "name": "proxy-service",
      "image": "budibase/proxy:3.20.6",
      "environment": {
        "PROXY_RATE_LIMIT_WEBHOOKS_PER_SECOND": "10",
        "PROXY_RATE_LIMIT_API_PER_SECOND": "50",
        "APPS_UPSTREAM_URL": "http://app-service:${APP_PORT}",
        "WORKER_UPSTREAM_URL": "http://worker-service:${WORKER_PORT}",
        "MINIO_UPSTREAM_URL": "http://minio-service:${MINIO_PORT}",
        "COUCHDB_UPSTREAM_URL": "http://couchdb-service:${COUCH_DB_PORT}",
        "RESOLVER": "127.0.0.11"
      },
      "internalPort": 10000,
      "dependsOn": {
        "minio-service": {
          "condition": "service_started"
        },
        "worker-service": {
          "condition": "service_started"
        },
        "app-service": {
          "condition": "service_started"
        },
        "couchdb-service": {
          "condition": "service_started"
        }
      },
      "isMain": true
    },
    {
      "name": "couchdb-service",
      "image": "budibase/couchdb:v3.3.3-sqs-v2.1.1",
      "environment": {
        "COUCHDB_PASSWORD": "${COUCH_DB_PASSWORD}",
        "COUCHDB_USER": "${COUCH_DB_USER}",
        "TARGETBUILD": "docker-compose"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/budibase/couchdb",
          "containerPath": "/opt/couchdb/data",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ]
    },
    {
      "name": "redis-service",
      "image": "redis:8.2.1",
      "command": "redis-server --requirepass \"${REDIS_PASSWORD}\"",
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/budibase/redis",
          "containerPath": "/data",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ]
    }
  ]
}
